# Настоящий документ описывает протокол взаимодействия между головным устройством (далее - MASTER) и модулем расширения (далее - EXT_MODULE) от внешних разработчиков.

## MASTER - устройство, обеспечивающее взаимодействие с приложением по Bluethooth и считывание данных с датчиков, а также фильтрацию и калибровку данных
## EXT_MODULE - устройство, обеспечивающее работу с реальным физическим датчиком и нормирование сырых данных к значениям физической величины

* количество датчиков в рамках одного EXT_MODULE - от 1 и выше;
* количество каналов в рамках одного датчика - от 1 и выше;
* физический интерфейс для подключения EXT_MODULE к MASTER - UART в дуплексном режиме, скорость 115200;
* протокол команд - АТ;
* протокол данных - строковый протокол плоттера.

MASTER общается с EXT_MODULE посредством AT-команд. Ниже приведён список команд и ожидаемые ответы:
|№|Request from MASTER                                     |Response from EXT_MODULE                              |
|-|:------------------------------------------------------:|:----------------------------------------------------:|
|1|"AT"                                                    |"OK"                                                  |
|2|"AT+SCFG=<uuid>,<state>,<range_index>,<polling_period>" |"OK" or "ERROR"                                       |
|3|"AT+SAU?"                                               |"AT+SAU=<uuid>" or "ERROR"                            |
|4|"AT+SSG?"                                               |\<value in data format\>                              |
|5|"AT+SCS?"                                               |\<value in data format\> \<value in data format\> ... |
|6|"AT+SPS?"                                               |"OK"                                                  |

Каждая посылка (кроме **value in data format**) должна заканчиваться ESCAPE-последовательностью "\r\n".
  
Рассмотрим подробнее:
1. Запрос наличия и работоспособности EXT_MODUTE - классическая АТ-команда "АТ". EXT_MODULE должен ответить "OK".
2. Задание настроек конкретному датчику (Sensor ConFiGuration). EXT_MODULE должен ответить "OK" в случае успешного применения настроек или "ERROR" в случае ошибочных параметров. Разберём подробнее её поля значений.
    * \<uuid\> - стандартный UUID датчика в формате "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".  
    * \<state\> - состояние, в которое нужно перевести датчик. Доступны следующие состояния:
        * "OFF" - датчик не активен. Это состояние всех датчиков по умолчанию.
        * "ON" - датчик активен. Только **ОДИН** датчик может быть активен в текущий момент. Текущий активированный датчик автоматически выключается при включении следующего.
    * <range_index> - индекс выбранного диапазона изменений согласно спецификации. Формат - "integer", например - "0".
    * <polling_period> - период отправки значений датчика в непрерывном режиме. Задаётся в миллисекундах в формате "integer", например - "500".
3. Запрос UUID текущего активного датчика (Sensor Active UUID). EXT_MODULE должен ответить в формате "AT+SAU=\<uuid\>" если датчик активен, или "AT+SAU=\<NONE\>", если активных датчиков нет.
4. Однократный запрос значений активного датчика (Sensor Single Get). EXT_MODULE должен однократно передать значение(-я) датчика в специфическом data-формате.
5. Старт непрерывного опроса активного датчика (Sensor Continuous Start). EXT_MODULE должен начать передачу значения(-ий) в соответствии с установленных переодом опроса.
6. Остановка непрерывного опроса активного датчика (Sensor Polling Stop). EXT_MODULE должен остановить опрос датчика и ответить "OK".
